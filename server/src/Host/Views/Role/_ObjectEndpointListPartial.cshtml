@model List<ObjectEndpoint>
@using MySql.AspNet.Identity;
@{
    ViewData["Title"] = "Выбор разрешений для роли";
    List<ObjectEndpointPermitionViewModel> objectEndpointPermissions = ViewBag.objectEndpointPermissions as List<ObjectEndpointPermitionViewModel>;
    List<ObjectEndpointPermition> permissions = ViewBag.permissionsByRole as List<ObjectEndpointPermition>;
    string checked_ = "";
    string roleId = ViewBag.RoleId;
}
@if (Model.Count() > 0)
{
    <ul class="p-has-headers">
        @foreach (ObjectEndpoint objectEndpoint in Model)
        {
            <li>
                <h4 class="header" style="font-size: 11pt">
                    <a href="#@objectEndpoint.Id" data-toggle="collapse">
                        <span class="glyphicon glyphicon-plus"></span> @objectEndpoint.Value
                    </a>
                    <label>
                        &nbsp;<input type="checkbox" class="objectEndpoint" onchange="SelectAllEndpoints(this, '@roleId')">
                    </label>
                </h4>

                <ul class="p-has-headers collapse" id="@objectEndpoint.Id">
                    @foreach (ObjectEndpointPermitionViewModel objectEndpointPermission in objectEndpointPermissions)
                    {
                        if (objectEndpointPermission.ObjectEndpointId.Equals(objectEndpoint.Id))
                        {
                            checked_ = "";
                            @foreach (ObjectEndpointPermition permissionsByRole in permissions)
                            {
                                if (objectEndpointPermission.Id.Equals(permissionsByRole.Id))
                                {
                                    checked_ = "checked";
                                }
                            }
                            <li>
                                <h4 class="header" style="font-size: 11pt">
                                    <label><input type="checkbox" value="@objectEndpointPermission.Id" name="SelectedPermissions" class="SelectedPermissions" onchange="ChangeCheckPermission(this, '@roleId')" @checked_></label>&nbsp;@objectEndpointPermission.PermissionName
                                </h4>
                            </li>
                        }
                    }
                </ul>
            </li>
        }
    </ul>
}
